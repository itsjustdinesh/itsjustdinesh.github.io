<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>PricePilot Demo (stable)</title>
  <style>
    body{font-family:Arial, Helvetica, sans-serif; margin:24px; background:#f6fbfc; color:#05264b;}
    .wrap{max-width:980px;margin:0 auto;}
    .status{padding:10px;border-radius:8px;background:#05264b;color:#fff;margin-bottom:14px;}
    .card{background:#fff;padding:18px;border-radius:12px;box-shadow:0 6px 18px rgba(15,23,42,0.06);margin-bottom:18px;}
    .row{display:flex;justify-content:space-between;align-items:center;padding:12px;border-radius:10px;border:1px solid #eef3f7;margin-top:10px;}
    .price{font-weight:700}
    .market{background:#06b6d4;color:#fff;padding:8px 10px;border-radius:8px;text-decoration:none;}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>PricePilot</h1>
    <div id="status" class="status">initializing…</div>

    <div class="card">
      <label>Item: <input id="item" placeholder="e.g. Milk" /></label><br/><br/>
      <label>Qty: <input id="qty" type="number" value="1" style="width:60px" /></label>
      <select id="unit">
        <option value="kg">kg</option>
        <option value="l">l</option>
      </select>
      <button id="searchBtn" style="margin-left:12px;padding:8px 12px;">Search best price</button>
    </div>

    <div id="results"></div>
  </div>

  <script>
  // Minimal, self-contained script. No external files.
  (function(){
    const status = document.getElementById('status');
    function setStatus(s){ status.textContent = s; }

    // dataset (correct URL templates)
    const PRICES = {
      "milk": [
        { marketplace: "BigBasket", price: 50, url_template: "https://www.bigbasket.com/ps/?q={query}&nc=as" },
        { marketplace: "Zepto",     price: 55, url_template: "https://www.zepto.com/search?query={query}" },
        { marketplace: "Blinkit",   price: 60, url_template: "https://blinkit.com/s/?q={query}" }
      ],
      "quick sugar 1kg": [
        { marketplace: "BigBasket", price: 80, url_template: "https://www.bigbasket.com/ps/?q={query}&nc=as" },
        { marketplace: "Zepto",     price: 100, url_template: "https://www.zepto.com/search?query={query}" },
        { marketplace: "Blinkit",   price: 110, url_template: "https://blinkit.com/s/?q={query}" }
      ]
    };

    function qtext(item, qty, unit){
      item = (item||'').trim();
      if(!item) return '';
      if(/(kg|l|ltr|litre|liter)/i.test(item)) return item;
      return item + ' ' + (unit==='l' ? qty + ' l' : qty + ' kg');
    }
    function buildLink(template,item,qty,unit){
      return template.replace('{query}', encodeURIComponent(qtext(item,qty,unit)));
    }
    function find(item){
      const key = (item||'').trim().toLowerCase();
      if(PRICES[key]) return PRICES[key].slice();
      // contains match
      for(const k in PRICES) if(k.includes(key) || key.includes(k)) return PRICES[k].slice();
      return null;
    }

    function render(list,item,qty,unit){
      const out = document.getElementById('results'); out.innerHTML = '';
      if(!list){ out.innerHTML = '<div class="card">No prices found (try "milk" or "quick sugar 1kg").</div>'; return; }
      list.sort((a,b)=>a.price-b.price);
      list.forEach(e=>{
        const r = document.createElement('div'); r.className = 'row';
        r.innerHTML = '<div><span class="price">₹'+e.price+'</span> &nbsp;<span style="color:#667085">'+e.marketplace+'</span></div>';
        const a = document.createElement('a'); a.className='market'; a.href = buildLink(e.url_template,item,qty,unit); a.target='_blank'; a.textContent = 'Open';
        r.appendChild(a); out.appendChild(r);
      });
    }

    document.getElementById('searchBtn').addEventListener('click', ()=>{
      const item = document.getElementById('item').value || '';
      const qty = document.getElementById('qty').value || 1;
      const unit = document.getElementById('unit').value || 'kg';
      if(!item.trim()){ alert('Please enter an item'); return; }
      const found = find(item);
      render(found, item, qty, unit);
    });

    window.addEventListener('load', ()=> setStatus('loaded — dataset keys: '+Object.keys(PRICES).join(', ')));
  })();
  </script>
</body>
</html>
